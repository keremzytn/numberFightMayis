@model numberFightMayis.Models.Game

@{
    ViewData["Title"] = "Sayı Savaşı";
}

<style>
    .game-over-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        z-index: 1000;
        justify-content: center;
        align-items: center;
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
    }

    .game-over-modal.show {
        display: flex;
        opacity: 1;
    }

    .modal-content {
        background-color: white;
        padding: 2rem;
        border-radius: 1rem;
        max-width: 500px;
        width: 90%;
        text-align: center;
        animation: modalFadeIn 0.3s ease-out;
    }

    @@keyframes modalFadeIn {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .modal-header h2 {
        color: #333;
        margin-bottom: 1.5rem;
    }

    .result-message {
        margin: 2rem 0;
        padding: 1.5rem;
        border-radius: 0.5rem;
    }

    .result-message i {
        font-size: 3rem;
        margin-bottom: 1rem;
    }

    .win {
        background-color: #d4edda;
        color: #155724;
    }

    .lose {
        background-color: #f8d7da;
        color: #721c24;
    }

    .draw {
        background-color: #fff3cd;
        color: #856404;
    }

    .score-summary {
        margin: 1.5rem 0;
        font-size: 1.2rem;
    }

    .score-summary p {
        margin: 0.5rem 0;
    }

    .modal-footer {
        margin-top: 1.5rem;
    }

    .modal-footer .btn {
        padding: 0.5rem 2rem;
        font-size: 1.1rem;
    }
</style>

<div class="container mt-5">
    <h1 class="text-center mb-4">Sayı Savaşı</h1>

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger">
            @TempData["ErrorMessage"]
        </div>
    }

    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h3>Oyuncu 1 (Siz)</h3>
                </div>
                <div class="card-body">
                    <p>Puanınız: @Model.Player1Score</p>
                    <p>Kullanılan Kartlar: @string.Join(", ", Model.Player1UsedCards)</p>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h3>Bilgisayar</h3>
                </div>
                <div class="card-body">
                    <p>Puanı: @Model.Player2Score</p>
                    @if (Model.Player2LastCard.HasValue)
                    {
                        <p>Son Kullanılan Kart: @Model.Player2LastCard</p>
                    }
                </div>
            </div>
        </div>
    </div>

    <div class="text-center mt-4">
        <h4>Raund: @Model.CurrentRound / 7</h4>
    </div>

    @if (!Model.IsGameOver)
    {
        <div class="row mt-4">
            <div class="col-12 text-center">
                <h4>Kartınızı Seçin:</h4>
                <div class="btn-group">
                    @for (int i = 1; i <= 7; i++)
                    {
                        if (!Model.Player1UsedCards.Contains(i) && 
                            (!Model.Player1LastCard.HasValue || 
                             (i != Model.Player1LastCard.Value - 1 && i != Model.Player1LastCard.Value + 1)))
                        {
                            <form asp-action="PlayRound" method="post" style="display: inline;">
                                <input type="hidden" name="playerCard" value="@i" />
                                <button type="submit" class="btn btn-primary m-1">@i</button>
                            </form>
                        }
                        else
                        {
                            <button class="btn btn-secondary m-1" disabled>@i</button>
                        }
                    }
                </div>
            </div>
        </div>
    }

    @if (Model.IsGameOver)
    {
        <div class="game-over-modal" id="gameOverModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Oyun Bitti!</h2>
                </div>
                <div class="modal-body">
                    @if (Model.Winner == "Oyuncu 1")
                    {
                        <div class="result-message win">
                            <i class="fas fa-trophy"></i>
                            <h3>Tebrikler! Kazandınız!</h3>
                            <p>+100 Gold kazandınız!</p>
                        </div>
                    }
                    else if (Model.Winner == "Bilgisayar")
                    {
                        <div class="result-message lose">
                            <i class="fas fa-times-circle"></i>
                            <h3>Maalesef Kaybettiniz</h3>
                            <p>Bir sonraki oyunda daha şanslı olabilirsiniz!</p>
                        </div>
                    }
                    else
                    {
                        <div class="result-message draw">
                            <i class="fas fa-handshake"></i>
                            <h3>Berabere!</h3>
                            <p>İyi bir mücadeleydi!</p>
                        </div>
                    }
                    <div class="score-summary">
                        <p>Oyuncu: @Model.Player1Score</p>
                        <p>Bilgisayar: @Model.Player2Score</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <form asp-action="NewGame" method="post">
                        <button type="submit" class="btn btn-primary">Yeni Oyun</button>
                    </form>
                </div>
            </div>
        </div>
    }
</div>

@section Scripts {
    <script>
        // 30 saniyelik süre sayacı
        let timeLeft = 30;
        const timerElement = document.createElement('div');
        timerElement.className = 'text-center mt-3';
        document.querySelector('.text-center').appendChild(timerElement);

        const timer = setInterval(() => {
            if (timeLeft <= 0) {
                clearInterval(timer);
                location.reload();
            } else {
                timerElement.textContent = `Kalan Süre: ${timeLeft} saniye`;
                timeLeft--;
            }
        }, 1000);

        // Oyun bittiğinde popup'ı göster
        @if (Model.IsGameOver)
        {
            <text>
            document.addEventListener('DOMContentLoaded', function() {
                const modal = document.getElementById('gameOverModal');
                if (modal) {
                    modal.style.display = 'flex';
                    modal.style.opacity = '1';
                }
            });
            </text>
        }
    </script>
} 